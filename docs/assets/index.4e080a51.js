var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(t,l,n)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[l]=n,o=(e,t)=>{for(var l in t||(t={}))s.call(t,l)&&r(e,l,t[l]);if(n)for(var l of n(t))a.call(t,l)&&r(e,l,t[l]);return e},i=(e,n)=>t(e,l(n));import{o as d,c,a as u,b as m,u as g,d as p,F as f,e as v,f as w,t as h,r as b,g as y,h as x,i as k,j,k as I,w as L,l as N,n as C,m as M,v as B,D,p as E,q as H,T as O,s as P,x as A,y as _,z as S,A as T,M as F,B as z}from"./vendor.80661443.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const l of e)if("childList"===l.type)for(const e of l.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const V={},q={xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-45",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},R=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"},null,-1)];V.render=function(e,t){return d(),c("svg",q,R)};const U={class:"\n      flex flex-col\n      justify-end\n      h-52\n      lg:h-72\n      bg-primary\n      p-6\n      lg:p-12\n      rounded-box\n      shadow-md\n      text-white\n    "},$=u("div",{class:"text-2xl lg:text-6xl pb-1 lg:pb-4 font-bold"},"Hi, 欢迎使用 MPCB！",-1),K={class:"flex flex-col lg:flex-row w-full justify-between"},G=u("div",{class:"text-base lg:text-3xl"},"简洁高效的批量下载魅族云相册中的图片。",-1),J={href:"https://github.com/moreant/mpcb",target:"_blank",class:"btn-link text-base lg:text-3xl text-white"},Q=v("使用文档 "),W={key:0,class:"mt-6 lg:mt-12 alert alert-warning text-sm lg:text-base shadow-md"},X=[u("div",{class:"flex-1"},[u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"w-6 h-6 mx-2 stroke-current"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),u("label",null,"注意！这是在线体验版，数据皆为程序随机生成。\b如需使用，请按「使用文档」的说明进行安装。")],-1)],Y={setup:e=>(e,t)=>(d(),c(f,null,[u("div",U,[$,u("div",K,[G,u("a",J,[Q,m(V,{class:"w-4 lg:w-5 h-6 inline"})])])]),g(true)?(d(),c("div",W,X)):p("v-if",!0)],64))};let Z=w.create({baseURL:"https://www.fastmock.site/mock/6fcb874a89760d55eebabfa894e1312e/mpcb",timeout:1e4});Z.interceptors.response.use((e=>{const t=e.data;return 200!==t.code?Promise.reject(new Error(t.message||"错误")):t}),(e=>(console.log("err"+e),Promise.reject(e))));const ee=(e,t,l,n)=>Z.get("/down_img.json",{params:{token:e,dir:t,url:l,fileName:n}}),te={class:"mt-6 lg:mt-12"},le={class:"card shadow-md w-full flex-col lg:flex-row"},ne={class:"card-body w-full p-4 lg:p-8 lg:w-1/2"},se={class:"card-title"},ae=u("div",{class:"divider divider-vertical opacity-10 hidden lg:flex lg:p-8"},null,-1),re={class:"card-body w-full p-4 lg:p-8 lg:w-1/2"},oe={props:{step:String,title:String},setup:e=>(t,l)=>(d(),c("div",te,[u("div",le,[u("div",ne,[u("h2",se,"第 "+h(e.step)+" 步",1),u("p",null,h(e.title),1),b(t.$slots,"left")]),ae,u("div",re,[b(t.$slots,"right")])])]))},ie={class:"flex space-x-2"},de={href:"http://topurl.cn/809",target:"_blank",class:"btn btn-link p-0"},ce=v("获取 Token ? "),ue={class:"card-title"},me=v(" 运行结果 "),ge={emits:["change"],setup(e,{emit:t}){const l=y(x.get("token")),n=k({time:"",msg:"",flag:0}),s=async()=>{try{await(e=>Z.get("/token.json",{params:{token:e}}))(l.value),t("change",l.value),n.msg="校验 Token 成功.",x.set("token",l.value),n.flag=1}catch(e){let l=e.message;"用户信息验证失败"===l&&(l+=", 请重新获取 Token."),t("change",""),n.msg=l,n.flag=-1}n.time=N().format("HH:mm:ss")};return l.value="在线体验随意输入",s(),l.value&&s(),(e,t)=>(d(),j(oe,{step:"1",title:"输入 Token 获取用户信息。",flag:g(n).flag},I({left:L((()=>[u("div",ie,[M(u("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),type:"text",placeholder:"token",class:"w-full input input-primary input-bordered"},null,512),[[B,l.value]]),u("button",{onClick:s,class:"btn btn-primary"},"提交")]),u("div",null,[u("a",de,[ce,m(V)])])])),_:2},[0!==g(n).flag?{name:"right",fn:L((()=>[u("h2",ue,[me,u("div",{class:C(["badge badge-lg",{"badge-success":1===g(n).flag,"badge-error":-1===g(n).flag}])},h(1===g(n).flag?"成功":"失败"),3)]),u("p",null,h(g(n).time),1),u("p",null,h(g(n).msg),1)]))}:void 0]),1032,["flag"]))}};class pe extends D{constructor(){super("database"),this.version(1).stores({imgs:"id,dirId,[dirId+download],fileName,[dirId+url]",errorLog:"key++,dirId,time,msg"}),this.imgs=this.table("imgs"),this.errorLog=this.table("errorLog")}bulkImg(e){return this.imgs.bulkAdd(e)}updateDownload(e,t){return this.imgs.update(e,{download:t})}getImgsDownNum(e,t){return this.imgs.where({dirId:e,download:t}).count()}getImgs(e){return this.imgs.where(e).toArray()}addErrorlog(e){return this.errorLog.add(e)}getAllErrorLog(){return this.errorLog.reverse().sortBy("keys")}deleteAllErrorLog(){return this.errorLog.clear()}}const fe={class:"\n            flex\n            items-end\n            justify-center\n            min-h-screen\n            pt-4\n            px-4\n            pb-20\n            text-center\n            sm:block\n            sm:p-0\n          "},ve=u("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1),we={class:"\n                inline-block\n                align-bottom\n                bg-white\n                rounded-lg\n                text-left\n                overflow-hidden\n                shadow-xl\n                transform\n                transition-all\n                sm:my-8\n                sm:align-middle\n                sm:max-w-lg\n                sm:w-full\n              "},he={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},be={class:"sm:flex sm:items-start"},ye=u("div",{class:"\n                      mx-auto\n                      flex-shrink-0 flex\n                      items-center\n                      justify-center\n                      h-12\n                      w-12\n                      rounded-full\n                      bg-red-100\n                      sm:mx-0\n                      sm:h-10\n                      sm:w-10\n                    "},null,-1),xe={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},ke=v(" 删除\b下载记录 "),je=u("div",{class:"mt-2"},[u("p",{class:"text-sm text-gray-500"}," 将删除该相册的所有下载记录，本操作不会删除文件。 ")],-1),Ie={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Le={props:{open:{type:Boolean,default:!0}},emits:["close","ok"],setup(e,{emit:t}){const l=e;E((()=>{l.open&&(open.value=l.open)}));const n=()=>{t("close")},s=()=>{t("ok")};return(e,t)=>(d(),c("div",null,[m(g(_),{as:"template",show:l.open},{default:L((()=>[m(g(H),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:n},{default:L((()=>[u("div",fe,[m(g(O),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:L((()=>[m(g(P),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})])),_:1}),p(" This element is to trick the browser into centering the modal contents. "),ve,m(g(O),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:L((()=>[u("div",we,[u("div",he,[u("div",be,[ye,u("div",xe,[m(g(A),{as:"h3",class:"text-lg leading-6 text-gray-900"},{default:L((()=>[ke])),_:1}),je])])]),u("div",Ie,[u("button",{type:"button",class:"\n                    w-full\n                    inline-flex\n                    justify-center\n                    rounded-md\n                    border border-transparent\n                    shadow-sm\n                    px-4\n                    py-2\n                    bg-red-600\n                    text-base\n                    font-medium\n                    text-white\n                    hover:bg-red-700\n                    focus:outline-none\n                    focus:ring-2 focus:ring-offset-2 focus:ring-red-500\n                    sm:ml-3\n                    sm:w-auto\n                    sm:text-sm\n                  ",onClick:s}," 确定 "),u("button",{type:"button",class:"\n                    mt-3\n                    w-full\n                    inline-flex\n                    justify-center\n                    rounded-md\n                    border border-gray-300\n                    shadow-sm\n                    px-4\n                    py-2\n                    bg-white\n                    text-base\n                    font-medium\n                    text-gray-700\n                    hover:bg-gray-50\n                    focus:outline-none\n                    focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\n                    sm:mt-0\n                    sm:ml-3\n                    sm:w-auto\n                    sm:text-sm\n                  ",onClick:n,ref:cancelButtonRef}," 取消 ",512)])])])),_:1})])])),_:1})])),_:1},8,["show"])]))}};const Ne={id:"selectList",class:"menu my-3 bg-base-100 rounded-box border border-gray-300"},Ce=["onClick"],Me={class:"w-full"},Be={class:"flex"},De={class:"avatar"},Ee={class:"flex-none rounded-btn w-20 h-20"},He=["src"],Oe={class:"flex flex-grow flex-col ml-4"},Pe={class:"text-sm mt-1.5 text-gray-400"},Ae={class:"lg:hidden"},_e=["value","max"],Se={class:"hidden lg:block"},Te=["value","max"],Fe=u("h2",{class:"card-title",id:"downloadList"},"下载列表",-1),ze=u("div",null,"性能原因，下载列表至多显示500条（有空再弄虚拟列表）。",-1),Ve=["disabled"],qe={xmlns:"http://www.w3.org/2000/svg",class:"inline-block w-6 h-6 mr-2 stroke-current",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Re=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13l-3 3m0 0l-3-3m3 3V8m0 13a9 9 0 110-18 9 9 0 010 18z"},null,-1)],Ue=v(" 下载 "),$e=[u("svg",{xmlns:"http://www.w3.org/2000/svg",class:"inline-block w-6 h-6 mr-2 stroke-current",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),v(" 删除记录 ")],Ke={class:"overflow-auto"},Ge={class:"table w-full"},Je=u("thead",null,[u("tr",null,[u("th",null,"id"),u("th",null,"下载状态"),u("th",null,"图片名称")])],-1),Qe={props:{token:String},emits:["error"],setup(e,{emit:t}){const l=e,n=y(!1),s=y(!1),a=y([]),r=y(""),w=y([]),b=new pe,x=e=>w.value.find((t=>t.id===e));E((async()=>{if(l.token){const t=await(e=l.token,Z.get("/dir.json",{params:{token:e}}));let{dir:n=[]}=t.value;const s=n.map((e=>b.getImgsDownNum(e.id,"1"))),a=await Promise.all(s);n=n.map(((e,t)=>i(o({},e),{downNum:a[t]}))),w.value=n,n.map((e=>e.icon)).join(","),k(n)}var e}));const k=async(e,t)=>{w.value=e.map(((e,t)=>i(o({},e),{iconSrc:e.icon})))},B=async()=>{const e=r.value,t=await b.getImgs({dirId:e});await Promise.all(t.map((e=>b.updateDownload(e.id,"0")))),D(e),x(e).downNum=0,s.value=!1},D=async e=>{r.value=e;let t=await b.getImgs({dirId:e});if(0===t.length){const{value:{file:n}}=await((e,t)=>Z.get("/list.json",{params:{token:e,dirId:t}}))(l.token,e);{const t=x(e);n.length=t.fileNum}t=n.map((t=>({id:t.id,fileName:t.fileName,url:t.url,download:"0",dirId:e}))),await b.bulkImg(t)}t.length>500&&(t.length=500),a.value=t,document.getElementById("downloadList").parentNode.style.maxHeight=document.getElementById("selectList").parentNode.offsetHeight+"px"};return(e,o)=>(d(),c(f,null,[m(Le,{open:s.value,onClose:o[0]||(o[0]=e=>s.value=!1),onOk:B},null,8,["open"]),w.value.length>0?(d(),j(oe,{key:0,step:"2",title:"选择要下载的相册。"},I({left:L((()=>[u("ul",Ne,[(d(!0),c(f,null,T(w.value,((e,t)=>(d(),c("li",{class:C(["",{bordered:e.id===r.value,"bg-base-content":e.id===r.value,"bg-opacity-10":e.id===r.value}])},[u("a",{onClick:t=>D(e.id)},[u("div",Me,[u("div",Be,[u("div",De,[u("div",Ee,[M(u("img",{src:e.iconSrc},null,8,He),[[S,e.iconSrc]])])]),u("div",Oe,[v(h(e.dirName)+" ",1),u("div",Pe,h(e.fileNum)+" 张 ",1),u("div",Ae,[u("progress",{class:"flex-none w-24 progress progress-primary",value:e.downNum,max:e.fileNum},null,8,_e)])]),u("div",Se,[u("progress",{class:"flex-none w-24 progress progress-primary",value:e.downNum,max:e.fileNum},null,8,Te)])])])],8,Ce)],2)))),256))])])),_:2},[r.value?{name:"right",fn:L((()=>[Fe,u("div",null,"相册ID: "+h(r.value),1),ze,u("div",null,[u("button",{class:C(["btn btn-primary",{loading:n.value}]),disabled:n.value,onClick:o[1]||(o[1]=e=>(async e=>{let s=await b.getImgs({dirId:e,download:"0"});n.value=!0;for(let n=0;n<s.length;n++){const o=s[n];try{await ee(l.token,e,o.url,o.fileName),await b.updateDownload(o.id,"1");try{a.value.find((e=>e.id===o.id)).download="1"}catch(r){console.log(r)}const t=x(e);t.downNum=++t.downNum}catch(r){b.addErrorlog({dirId:e,time:N().format("M-D HH:mm:ss"),msg:r.message}),t("error")}}n.value=!1})(r.value))},[M((d(),c("svg",qe,Re,512)),[[S,!n.value]]),Ue],10,Ve),u("button",{class:"btn btn-error ml-4",onClick:o[2]||(o[2]=e=>s.value=!0)},$e)]),u("div",Ke,[u("table",Ge,[Je,u("tbody",null,[(d(!0),c(f,null,T(a.value,(e=>(d(),c("tr",{key:e.id},[u("td",null,h(e.id),1),u("td",null,[u("div",{class:C(["transition-all duration-500 ease-in-out badge",{"badge-success":e.download===g("1"),"badge-info":e.download===g("0")}])},h(e.download===g("1")?"已下载":"待下载"),3)]),u("td",null,h(e.fileName),1)])))),128))])])])]))}:void 0]),1024)):p("v-if",!0)],64))}},We={class:"mt-12"},Xe={class:"card shadow w-full flex-row"},Ye={class:"card-body w-1/2"},Ze=v(" 错误日志 "),et=[u("svg",{xmlns:"http://www.w3.org/2000/svg",class:"inline-block w-3 h-3 mr-2 stroke-current",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),v(" 删除所有日志 ")],tt={class:"overflow-x-auto"},lt={class:"table w-full"},nt=u("thead",null,[u("tr",null,[u("th",null,"#"),u("th",null,"DirId"),u("th",null,"发生时间"),u("th",null,"错误信息")])],-1),st={props:{changeFleg:Number},setup(e){const t=e,l=new pe,n=y([]);E((async()=>{t.changeFleg&&(n.value=await l.getAllErrorLog());{const e=F.mock({"errList|3-8":[{key:"@natural(1, 100)",dirId:"@natural(1, 100)",time:'@time("M-d HH:mm:ss")',msg:'错误信息 @cword("零一二三四五六七八九十", 5, 7)'}]});n.value=e.errList}}));const s=()=>{l.deleteAllErrorLog(),n.value=[]};return(e,t)=>(d(),c("div",We,[u("div",Xe,[u("div",Ye,[u("h2",{class:"card-title"},[Ze,u("button",{class:"btn btn-error btn-xs ml-4",onClick:s},et)]),u("div",tt,[u("table",lt,[nt,u("tbody",null,[(d(!0),c(f,null,T(n.value,(e=>(d(),c("tr",{key:e.key},[u("th",null,h(e.key),1),u("td",null,h(e.dirId),1),u("td",null,h(e.time),1),u("td",null,h(e.msg),1)])))),128))])])])])])]))}},at={class:"flex justify-center"},rt={class:"container p-4 lg:py-24 lg:pt-12"};z({setup(e){const t=y(""),l=y(Date.now());return(e,n)=>(d(),c("div",at,[u("div",rt,[m(Y),m(ge,{onChange:n[0]||(n[0]=e=>{t.value=e})}),m(Qe,{token:t.value,onError:n[1]||(n[1]=e=>l.value=Date.now())},null,8,["token"]),m(st,{changeFleg:l.value},null,8,["changeFleg"])])]))}}).mount("#app");
